@model CureLogix.WebUI.Models.SettingsViewModel
@{
    ViewData["Title"] = "Hesap Ayarları";
}

<div class="content-header">
    <div class="container-fluid"><h1>⚙️ Hesap ve Görünüm Ayarları</h1></div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">

            <!-- SOL KOLON: ŞİFRE DEĞİŞTİRME -->
            <div class="col-md-6">
                <div class="card card-primary card-outline">
                    <div class="card-header"><h3 class="card-title"><i class="fas fa-key"></i> Güvenlik</h3></div>
                    <form asp-action="ChangePassword" method="post">
                        <div class="card-body">
                            @if (TempData["Success"] != null)
                            {
                                <div class="alert alert-success alert-dismissible">
                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                                    <h5><i class="icon fas fa-check"></i> Başarılı!</h5>
                                    @TempData["Success"]
                                </div>
                            }

                            @if (TempData["Error"] != null)
                            {
                                <div class="alert alert-danger alert-dismissible">
                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                                    <h5><i class="icon fas fa-ban"></i> Hata!</h5>
                                    @TempData["Error"]
                                </div>
                            }
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                            <div class="form-group mb-3">
                                <label>Mevcut Şifre</label>
                                <input asp-for="CurrentPassword" class="form-control" />
                                <span asp-validation-for="CurrentPassword" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-3">
                                <label>Yeni Şifre</label>
                                <input asp-for="NewPassword" class="form-control" />
                                <span asp-validation-for="NewPassword" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label>Yeni Şifre (Tekrar)</label>
                                <input asp-for="ConfirmPassword" class="form-control" />
                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="card-footer text-right">
                            <button type="submit" class="btn btn-primary">Şifreyi Güncelle</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- SAĞ KOLON: KİŞİSELLEŞTİRME -->
            <div class="col-md-6">
                <div class="card card-info card-outline">
                    <div class="card-header"><h3 class="card-title"><i class="fas fa-palette"></i> Görünüm</h3></div>
                    <div class="card-body">

                        <div class="form-group mb-4">
                            <label class="d-block">Arayüz Teması</label>
                            <div class="btn-group w-100">
                                <button onclick="savePref('theme','light')" class="btn btn-outline-secondary @(Model.ActiveTheme == "light" ? "active" : "")">
                                    <i class="fas fa-sun"></i> Açık Mod
                                </button>
                                <button onclick="savePref('theme','dark')" class="btn btn-outline-dark @(Model.ActiveTheme == "dark" ? "active" : "")">
                                    <i class="fas fa-moon"></i> Koyu Mod
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Dashboard Grafik Tipi</label>
                            <select id="chartType" class="form-control" onchange="savePref('chart', this.value)">
                                <!option value="bar" @(Model.ActiveChart == "bar" ? "selected" : "")>Çubuk Grafik (Bar)</!option>
                                <!option value="line" @(Model.ActiveChart == "line" ? "selected" : "")>Çizgi Grafik (Line)</!option>
                            </select>
                            <small class="text-muted">Ana sayfadaki doluluk grafiğinin görünümünü değiştirir.</small>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<script>
    function savePref(type, value) {
        let payload = {};

        // Hangi ayarı değiştiriyorsak onu gönderiyoruz
        if(type === 'theme') payload.theme = value;
        else payload.chart = value;

        $.post('/Settings/SetPreference', payload, function () {
            // Ayarların anında yansıması için sayfayı yeniliyoruz
            window.location.reload();
        });
    }
</script>