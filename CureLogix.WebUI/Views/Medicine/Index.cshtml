@{
    ViewData["Title"] = "İlaç Envanteri (Server-Side)";
}

<!-- CSS: Artık 'datatables/css' altında -->
<link rel="stylesheet" href="~/lib/datatables/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="~/lib/datatables/css/responsive.bootstrap5.min.css">

<div class="content-header"><div class="container-fluid"><h1>💊 İlaç Kataloğu (Yüksek Performans)</h1></div></div>

<section class="content">
    <div class="container-fluid">
        <div class="card card-warning card-outline">
            <div class="card-body">
                <table id="medicineTable" class="table table-hover table-striped w-100">
                    <thead><tr><th>ID</th><th>İlaç Adı</th><th>Etken Madde</th><th>Birim</th><th>Kritik Stok</th><th>Özellik</th><th>İşlemler</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <!-- JS: Artık 'datatables/js' altında -->
    <script src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/lib/datatables/js/dataTables.bootstrap5.min.js"></script>
    <script src="~/lib/datatables/js/dataTables.responsive.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#medicineTable').DataTable({
                "processing": true, "serverSide": true, "filter": true,
                "ajax": { "url": "/Medicine/GetAllMedicinesAjax", "type": "POST", "datatype": "json" },
                "columnDefs": [{ "targets": [6], "orderable": false }],
                "columns": [
                    { "data": "Id", "name": "Id", "autoWidth": true },
                    { "data": "Name", "name": "Name", "autoWidth": true },
                    { "data": "ActiveIngredient", "name": "ActiveIngredient", "autoWidth": true },
                    { "data": "Unit", "name": "Unit", "autoWidth": true, "render": function (data) { return '<span class="badge bg-secondary">' + data + '</span>'; } },
                    { "data": "CriticalStockLevel", "name": "CriticalStockLevel", "autoWidth": true },
                    { "data": "RequiresColdChain", "name": "RequiresColdChain", "render": function (data) { return data === true ? '<span class="badge bg-info">Soğuk Zincir</span>' : '-'; } },
                    { "data": "Id", "render": function (data) { return `<a href='/Medicine/Update/${data}' class='btn btn-xs btn-outline-info'>Düzenle</a> <a href='/Medicine/Delete/${data}' class='btn btn-xs btn-outline-danger' onclick='return confirm("Sil?")'>Sil</a>`; } }
                ],
                // Dil dosyası kökte kalabilir
                "language": { "url": "/lib/datatables/tr.json" }
            });
        });
    </script>
}